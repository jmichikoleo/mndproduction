<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MND Production - Get In Touch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .minimal-input {
            background-color: transparent;
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.4);
            padding-bottom: 0.5rem;
            color: white;
            transition: border-bottom-color 0.3s ease;
            width: 100%;
        }
        .minimal-input:focus {
            outline: none;
            border-bottom-color: white;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #1e00ff, #ff00c3, #00eeff);
            background-size: 400% 400%;
            animation: gradient-shift 15s ease infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
    <!-- Firebase Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let userId = 'loading'; 

        const setStatusMessage = (message, isError = false) => {
            const statusEl = document.getElementById('form-status');
            statusEl.textContent = message;
            statusEl.className = isError
                ? 'text-red-400 mt-4 text-sm'
                : 'text-green-400 mt-4 text-sm';
        };

        const initFirebase = async () => {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is empty. Cannot initialize Firestore.");
                    setStatusMessage("Database connection failed. Check console for details.", true);
                    return;
                }
                
                setLogLevel('Debug');
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                userId = auth.currentUser?.uid || crypto.randomUUID();
                document.getElementById('user-id-display').textContent = `User ID: ${userId}`;
                console.log("Firebase initialized. User ID:", userId);

                setupInquiriesListener();

            } catch (error) {
                console.error("Error initializing Firebase or signing in:", error);
                setStatusMessage(`Initialization Error: ${error.message}`, true);
            }
        };

        const setupInquiriesListener = () => {
            if (!db) return;

            // Public collection path: /artifacts/{appId}/public/data/inquiries
            const inquiriesColRef = collection(db, `artifacts/${appId}/public/data/inquiries`);
            
            const q = query(inquiriesColRef); 
            
            onSnapshot(q, (snapshot) => {
                const inquiries = [];
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    inquiries.push({
                        id: doc.id,
                        name: data.name,
                        email: data.email,
                        message: data.message,
                        timestamp: data.timestamp ? new Date(data.timestamp.toDate()).toLocaleString() : 'N/A'
                    });
                });

                inquiries.sort((a, b) => {
                    const dateA = a.timestamp === 'N/A' ? 0 : new Date(a.timestamp).getTime();
                    const dateB = b.timestamp === 'N/A' ? 0 : new Date(b.timestamp).getTime();
                    return dateB - dateA; // Newest first
                });

                renderInquiries(inquiries);
            }, (error) => {
                console.error("Error listening to inquiries:", error);
                setStatusMessage("Failed to load past inquiries.", true);
            });
        };

        const renderInquiries = (inquiries) => {
            const listEl = document.getElementById('inquiries-list');
            listEl.innerHTML = ''; 

            if (inquiries.length === 0) {
                listEl.innerHTML = '<p class="text-gray-400">No inquiries submitted yet.</p>';
                return;
            }

            inquiries.forEach(inquiry => {
                const item = document.createElement('div');
                item.className = 'p-4 bg-gray-800 rounded-lg shadow-md mb-3 transition-all duration-300 hover:bg-gray-700';
                item.innerHTML = `
                    <p class="text-lg font-semibold text-white">${inquiry.name}</p>
                    <p class="text-sm text-blue-400">${inquiry.email}</p>
                    <p class="text-gray-300 mt-2">${inquiry.message}</p>
                    <p class="text-xs text-gray-500 mt-1">Submitted: ${inquiry.timestamp}</p>
                `;
                listEl.appendChild(item);
            });
        };


        const handleSubmit = async (event) => {
            event.preventDefault();
            
            if (!db) {
                setStatusMessage("Database not initialized. Please refresh.", true);
                return;
            }

            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const message = document.getElementById('message').value.trim();
            const submitButton = document.getElementById('submit-btn');

            if (!name || !email || !message) {
                setStatusMessage("Please fill in all fields.", true);
                return;
            }

            submitButton.disabled = true;
            submitButton.textContent = 'Sending...';
            setStatusMessage('');

            try {
                // Public collection path: /artifacts/{appId}/public/data/inquiries
                const inquiriesColRef = collection(db, `artifacts/${appId}/public/data/inquiries`);

                await addDoc(inquiriesColRef, {
                    name,
                    email,
                    message,
                    timestamp: new Date(),
                    userId // Store the user ID of the person submitting it
                });

                setStatusMessage("Thank you! Your inquiry has been sent successfully.", false);
                document.getElementById('contact-form').reset();

            } catch (error) {
                console.error("Error adding document:", error);
                setStatusMessage(`Submission failed: ${error.message}.`, true);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Send';
            }
        };

        window.onload = () => {
            initFirebase();
            document.getElementById('contact-form').addEventListener('submit', handleSubmit);

            document.getElementById('toggle-dashboard').addEventListener('click', () => {
                const dashboard = document.getElementById('inquiries-dashboard');
                dashboard.classList.toggle('hidden');
            });
        };

    </script>
</head>
<body class="bg-black text-white">

    <!-- Header / Navigation Bar -->
    <header class="p-6 md:p-8 flex justify-between items-center z-10 sticky top-0 bg-black/90">
        <!-- Logo -->
        <a href="#" class="flex items-center">
            <img src="./images/logomnd.png" alt="MDN Production Logo" class="h-15 w-auto">
        </a>
        <nav class="space-x-8 text-sm font-medium hidden sm:flex">
            <a href="./home.html" class="hover:text-gray-400 transition">Home</a>
            <a href="./contactus.html" class="text-white hover:text-gray-400 transition">Get In Touch</a>
        </nav>
        <div class="sm:hidden text-lg">☰</div> 
    </header>

    <!-- Main Contact Section (Dark Background) -->
    <main class="flex-grow pt-16 pb-24 px-6 md:px-12 lg:px-20 max-w-7xl mx-auto w-full">
        <div class="text-sm font-light flex items-center mb-8">
            <div class="w-2 h-2 rounded-full bg-white mr-2"></div>
            Get In Touch
        </div>

        <h1 class="text-4xl md:text-6xl lg:text-7xl font-light max-w-4xl leading-tight mb-16">
            Drop us a line—let's make something amazing.
        </h1>

        <!-- Contact Form -->
        <form id="contact-form" class="max-w-4xl space-y-12">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-16 gap-y-12">
                <!-- Name Field -->
                <div>
                    <input type="text" id="name" placeholder="Name" required class="minimal-input placeholder-gray-400 text-lg">
                    <label for="name" class="sr-only">Name</label>
                </div>

                <!-- Message Field ("What's on your mind?") -->
                <div>
                    <input type="text" id="message" placeholder="What's on your mind?" required class="minimal-input placeholder-gray-400 text-lg">
                    <label for="message" class="sr-only">What's on your mind?</label>
                </div>

                <!-- Email Field (Single column, so it takes full width) -->
                <div class="md:col-span-2">
                    <input type="email" id="email" placeholder="Email" required class="minimal-input placeholder-gray-400 text-lg">
                    <label for="email" class="sr-only">Email</label>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-end pt-4">
                <button type="submit" id="submit-btn" class="bg-white text-black font-semibold py-3 px-8 rounded-full hover:bg-gray-200 transition-colors shadow-lg">
                    Send
                </button>
            </div>
            
            <p id="form-status" class="text-sm h-5"></p>
        </form>


        <div class="mt-20 border-t border-gray-700 pt-10">
            <button id="toggle-dashboard" class="text-blue-400 hover:text-blue-300 transition text-sm mb-4">
                [ Toggle Submitted Inquiries Dashboard ]
            </button>
            <div id="inquiries-dashboard" class="hidden bg-gray-900 p-6 rounded-xl shadow-2xl">
                <h2 class="text-2xl font-semibold mb-6">Real-time Inquiry Data (Admin View)</h2>
                <p id="user-id-display" class="text-xs text-gray-500 mb-4"></p>
                <div id="inquiries-list" class="space-y-3">

                    <p class="text-gray-400">Loading inquiries...</p>
                </div>
            </div>
        </div>

    </main>


    <section class="h-screen flex flex-col justify-center items-center text-center text-white p-6 relative" 
                style="background-image: url('./images/bg.jpg'); background-size: cover; background-position: center;">
                <div class="absolute inset-0 bg-black opacity-30"></div> 

                <div class="relative z-10 flex flex-col items-center">
            
                    <h2 class="text-6xl sm:text-7xl font-light mb-12 max-w-4xl leading-tight">
                    Great minds <br> create together
                    </h2>
            
                    <a href="./workpage.html" class="bg-white text-black py-3 px-10 rounded-lg text-lg font-medium hover:bg-gray-200 transition duration-300 shadow-xl tracking-wider">
                    Our Works
                    </a>
 
                    <div class="mt-20 space-x-6 text-lg font-light">
                        <a href="https://www.instagram.com/mnd.production.id/" class="hover:underline transition duration-300" target="_blank" rel="noopener noreferrer">Instagram</a>
                        <a href="#" class="hover:underline transition duration-300">YouTube</a>
                        <a href="#" class="hover:underline transition duration-300">LinkedIn</a>
                    </div>
                </div>
        

                <p class="absolute bottom-6 left-6 text-xs text-white/70">
                    ©2025 MND Production
                </p>
            </section>

</body>

</html>
